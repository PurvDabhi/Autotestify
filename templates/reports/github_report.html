<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoTestify - GitHub Analysis Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.3.0.min.js"></script>
    <style>        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
        }
        .metric-card {
            border: none;
            border-left: 4px solid #007bff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .grade-A { border-left-color: #28a745; }
        .grade-B { border-left-color: #ffc107; }
        .grade-C { border-left-color: #fd7e14; }
        .grade-D { border-left-color: #dc3545; }
        .grade-F { border-left-color: #6c757d; }
        .chart-container {
            min-height: 400px;
            margin: 1rem 0;
            width: 100%;
            overflow: hidden;
            position: relative;
        }
        
        /* Responsive Design Improvements */
        @media (max-width: 1200px) {
            .chart-container {
                min-height: 350px;
            }
        }
        
        @media (max-width: 992px) {
            .chart-container {
                min-height: 320px;
            }
        }
        
        @media (max-width: 768px) {
            .container-fluid {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            .chart-container {
                min-height: 300px;
            }
            
            .metric-card .card-body {
                padding: 1rem;
            }
            
            .report-header {
                padding: 1.5rem;
            }
            
            .report-header h1 {
                font-size: 1.5rem;
            }
            
            .report-header h2 {
                font-size: 1.25rem;
            }
        }
        
        @media (max-width: 576px) {
            .col-lg-6 {
                margin-bottom: 1rem;
            }
            
            .chart-container {
                min-height: 280px;
            }
            
            .metric-card .card-body {
                padding: 0.75rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .chart-container {
                min-height: 250px;
            }
            
            .report-header h1 {
                font-size: 1.25rem;
            }
            
            .report-header h2 {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="report-header text-center">
        <h1><i class="fab fa-github me-3"></i>GitHub Repository Analysis</h1>
        <h2>{{ repo_data.full_name }}</h2>
        <p class="mb-0">Generated on {{ generated_at.strftime('%B %d, %Y at %I:%M %p') }}</p>
    </div>

    <div class="container-fluid py-4">
        <!-- Repository Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-info-circle me-2"></i>Repository Overview</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <table class="table table-borderless">
                                    <tr>
                                        <td><strong>Name:</strong></td>
                                        <td>{{ repo_data.name }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Description:</strong></td>
                                        <td>{{ repo_data.description or 'No description provided' }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Language:</strong></td>
                                        <td>{{ repo_data.language or 'Not specified' }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Created:</strong></td>
                                        <td>{{ repo_data.created_at.strftime('%B %d, %Y') }}</td>
                                    </tr>
                                    <tr>
                                        <td><strong>Last Updated:</strong></td>
                                        <td>{{ repo_data.updated_at.strftime('%B %d, %Y') }}</td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-4">
                                <div class="row g-2">
                                    <div class="col-6">
                                        <div class="card metric-card text-center">
                                            <div class="card-body p-3">
                                                <h4 class="text-primary">{{ repo_data.stars }}</h4>
                                                <small>Stars</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="card metric-card text-center">
                                            <div class="card-body p-3">
                                                <h4 class="text-success">{{ repo_data.forks }}</h4>
                                                <small>Forks</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="card metric-card text-center">
                                            <div class="card-body p-3">
                                                <h4 class="text-info">{{ repo_data.branches|length }}</h4>
                                                <small>Branches</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="card metric-card text-center">
                                            <div class="card-body p-3">
                                                <h4 class="text-warning">{{ repo_data.files|length }}</h4>
                                                <small>Code Files</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Code Quality Overview -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h3><i class="fas fa-brain me-2"></i>AI Code Quality Assessment</h3>
                        <div class="badge bg-primary fs-6">Overall Grade: {{ code_assessment.overall_grade }}</div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card metric-card grade-{{ code_assessment.overall_grade.replace('+', '').replace('-', '') }}">
                                    <div class="card-body text-center">
                                        <h2 class="text-primary">{{ code_assessment.overall_score }}/100</h2>
                                        <p class="mb-0">Overall Score</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-8">
                                <h5>Summary</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6 class="text-success">Strengths</h6>
                                        <ul class="list-unstyled">
                                            {% for strength in code_assessment.summary.strengths %}
                                            <li><i class="fas fa-check text-success me-2"></i>{{ strength }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="text-warning">Areas for Improvement</h6>
                                        <ul class="list-unstyled">
                                            {% for weakness in code_assessment.summary.weaknesses %}
                                            <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>{{ weakness }}</li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        {% if charts %}
        <div class="row mb-4">
            {% if charts.commit_activity %}
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line me-2"></i>Commit Activity</h5>
                    </div>
                    <div class="card-body">
                        <div id="commitChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if charts.grade_distribution %}
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-pie me-2"></i>Code Quality Distribution</h5>
                    </div>
                    <div class="card-body">
                        <div id="gradeChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if charts.file_types %}
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-bar me-2"></i>File Type Distribution</h5>
                    </div>
                    <div class="card-body">
                        <div id="fileTypeChart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- File Assessments -->
        {% if code_assessment.file_assessments %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-code me-2"></i>File-by-File Analysis</h3>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            {% for assessment in code_assessment.file_assessments %}
                            <div class="col-lg-6">
                                <div class="card metric-card grade-{{ assessment.grade.replace('+', '').replace('-', '') }}">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between align-items-start mb-2">
                                            <h6 class="card-title mb-0">{{ assessment.file_name }}</h6>
                                            <span class="badge bg-primary">{{ assessment.grade }}</span>
                                        </div>
                                        <p class="text-muted small mb-2">{{ assessment.file_type }} â€¢ Score: {{ assessment.score }}/100</p>
                                        
                                        {% if assessment.strengths %}
                                        <div class="mb-2">
                                            <small class="text-success fw-bold">Strengths:</small>
                                            <ul class="list-unstyled mb-0" style="font-size: 0.8rem;">
                                                {% for strength in assessment.strengths[:2] %}
                                                <li><i class="fas fa-check text-success me-1"></i>{{ strength }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        {% endif %}
                                        
                                        {% if assessment.suggestions %}
                                        <div class="mb-0">
                                            <small class="text-primary fw-bold">Suggestions:</small>
                                            <ul class="list-unstyled mb-0" style="font-size: 0.8rem;">
                                                {% for suggestion in assessment.suggestions[:2] %}
                                                <li><i class="fas fa-lightbulb text-primary me-1"></i>{{ suggestion }}</li>
                                                {% endfor %}
                                            </ul>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Recommendations -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-lightbulb me-2"></i>Recommendations</h3>
                    </div>
                    <div class="card-body">
                        {% if code_assessment.summary.recommendations %}
                        <ul class="list-group list-group-flush">
                            {% for recommendation in code_assessment.summary.recommendations %}
                            <li class="list-group-item border-0 px-0">
                                <i class="fas fa-arrow-right text-primary me-2"></i>{{ recommendation }}
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-muted">No specific recommendations at this time. Keep up the good work!</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if selenium_ui %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-desktop me-2"></i>Selenium UI Validation</h3>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <table class="table table-bordered">
                            <tbody>
                                {% for key, value in selenium_ui.items() %}
                                    {% if key != "screenshot_path" %}
                                    <tr>
                                        <th>{{ key | replace('_', ' ') | title }}</th>
                                        <td>
                                            {% if value is boolean %}
                                                {% if value %}
                                                    <span class="badge bg-success">Present</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Missing</span>
                                                {% endif %}
                                            {% else %}
                                                {{ value }}
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endif %}
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if selenium_ui.screenshot_path %}
                    <div class="col-md-6 text-center">
                        <h5>GitHub Repository Screenshot</h5>
                        <div class="screenshot-container">
                            <img src="/screenshots/{{selenium_ui.screenshot_path}}" alt="GitHub Repository Screenshot" class="img-fluid rounded shadow border" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='block'">
                            <div style="display:none" class="alert alert-warning">Screenshot not available</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}

    </div>


    <script>
        // Render charts with full responsive configuration
        function renderChart(elementId, chartData) {
            try {
                var config = {
                    responsive: true,
                    displayModeBar: false,
                    toImageButtonOptions: {
                        format: 'png',
                        filename: 'chart',
                        height: 400,
                        width: 600,
                        scale: 1
                    }
                };
                
                // Ensure layout is fully responsive
                if (chartData.layout) {
                    chartData.layout.autosize = true;
                    chartData.layout.responsive = true;
                    
                    // Adjust margins for mobile
                    if (window.innerWidth <= 768) {
                        chartData.layout.margin = {l: 30, r: 30, t: 40, b: 40};
                        chartData.layout.height = 300;
                    } else if (window.innerWidth <= 576) {
                        chartData.layout.margin = {l: 20, r: 20, t: 35, b: 35};
                        chartData.layout.height = 280;
                    }
                    
                    // Adjust font sizes for mobile
                    if (window.innerWidth <= 576) {
                        chartData.layout.font = {size: 10};
                        if (chartData.layout.title) {
                            chartData.layout.title.font = {size: 12};
                        }
                    }
                }
                
                Plotly.newPlot(elementId, chartData.data, chartData.layout, config);
                
            } catch(e) {
                console.error('Error rendering chart for ' + elementId + ':', e);
                document.getElementById(elementId).innerHTML = '<div class="alert alert-warning">Chart could not be loaded</div>';
            }
        }
        
        // Handle window resize with debouncing
        let resizeTimeout;
        function handleResize() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
                ['commitChart', 'gradeChart', 'fileTypeChart'].forEach(function(chartId) {
                    var element = document.getElementById(chartId);
                    if (element && element.data) {
                        Plotly.Plots.resize(chartId);
                    }
                });
            }, 250);
        }
        
        // Render charts when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            {% if charts.commit_activity %}
            var commitData = {{ charts.commit_activity|safe }};
            renderChart('commitChart', commitData);
            {% endif %}

            {% if charts.grade_distribution %}
            var gradeData = {{ charts.grade_distribution|safe }};
            renderChart('gradeChart', gradeData);
            {% endif %}

            {% if charts.file_types %}
            var fileTypeData = {{ charts.file_types|safe }};
            renderChart('fileTypeChart', fileTypeData);
            {% endif %}
            
            // Add resize listener
            window.addEventListener('resize', handleResize);
        });
    </script>
</body>
</html>